package com.msaProjectMenu01.core.util;

import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.security.SecureRandom;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Map;
import java.util.Random;

import com.msaProject.core.util.UserInfo;

import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpSession;

public class Util {

	// 첨부파일 Rename
	public static String getUuid(String pkValue, String fieldName)  throws Exception {
		Random numGen = SecureRandom.getInstance("SHA1PRNG");
		int randomInt = (numGen.nextInt(6)) + 1; 
		Date date = new Date();
		SimpleDateFormat sdf = new SimpleDateFormat("yyyyMMddHHmmSS");
		String curDate = sdf.format(date);
		String strRowNum = "";
		String fileName = pkValue + curDate + strRowNum + randomInt; // 파일 rename시 변경할 부분
		return fileName; 
	}
	
	public static byte[] convertFileToByteArray(String filePath) throws IOException {
        File file = new File(filePath);
        FileInputStream fis = null;
        byte[] byteArray = new byte[(int) file.length()];

        try {
            fis = new FileInputStream(file);
            fis.read(byteArray);
        } finally {
            if (fis != null) {
                fis.close();
            }
        }

        return byteArray;
    }
	
	public static Map<String,Object> getSessionData(HttpServletRequest request) throws IOException, ClassNotFoundException {
		HttpSession session = request.getSession();
		String sessId = session.getId();
		if( sessId.indexOf(".") > -1 ) {
			sessId = sessId.substring(0, sessId.indexOf("."));
		}
		Object object = session.getServletContext().getContext("/").getAttribute(sessId);
		Map<String, Object> sessionMap = null;
		if( object != null ) {
			UserInfo userInfo = (UserInfo) deserialize(object.toString());
			if( userInfo != null ) {
				sessionMap = userInfo.getMaps();
			}
		}
		return sessionMap;
	}
}
